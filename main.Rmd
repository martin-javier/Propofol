---
title: "Propofol Main"
author: "Martin Kandlinger"
date: "2024-11-26"
output: html_document
---

Set working directory

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
if (!require(rstudioapi)) install.packages("rstudioapi")
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
```

Soure all code files

```{r}
# source(source_all.R) => kommt noch
source("code/install_packages.R") # hier bitte nur packages rein, die wir am Ende auch brauchen werden
# sonst laden wir am Ende unn√∂tige packages obwohl sie nicht genutzt werden
```

Import and manipulate datasets

```{r}
source("code/import_and_clean.R")
data_summed_Day0To11 <- clean_and_summarise_Days0To11()
data_summed_Day0To7 <- clean_and_summarise_Days0To7()
data_long <- clean_data()
manualPED_death <- create_ped_manually(data_long, "death")
manualPED_disc <- create_ped_manually(data_long, "discharge")
# ignore NaNs warning - there aren't any in the dataframes
```

Import all Models

```{r}
model_files <- list.files("models", pattern = "\\.rds$", full.names = TRUE, recursive = TRUE)

# Load models dynamically into the environment
for (file in model_files) {
  model_name <- tools::file_path_sans_ext(basename(file)) # Extract model name
  assign(model_name, readRDS(file)) # Load the model and assign it to the environment
}
```

Save all plots

```{r}
source("code/plots_descriptive.R")
for(i in seq_along(desc_plots)) {
  filename <- paste0("plots/descriptive/", desc_plot_names[i], ".png")
  ggsave(filename, plot = desc_plots[[i]], device = "png", width = 18, height = 8.25)
}

source("code/plots_models.R")
for(i in seq_along(model_plots)) {
  filename <- paste0("plots/models/", model_plot_names[i], ".png")
  ggsave(filename, plot = model_plots[[i]], device = "png", width = 18, height = 8.25)
}

source("code/plots_splines.R")
for(i in seq_along(model_splines)) {
  filename <- paste0("plots/models/", model_splines_names[i], ".png")
  ggsave(filename, plot = model_splines[[i]], device = "png", width = 18, height = 8.25)
}
```
